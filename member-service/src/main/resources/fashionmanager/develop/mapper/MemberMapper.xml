<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fashionmanager.develop.mapper.MemberMapper">
    <select id="selectMessageAllow" parameterType="string" resultType="fashionmanager.develop.dto.MemberDTO">
        SELECT
            A.NUM AS memberNum
             , A.ID AS memberId
             , A.PWD AS memberPwd
             , A.EMAIL AS memberEmail
             , A.NAME AS memberName
             , A.AGE AS memberAge
             , A.GENDER AS memberGender
             , A.HEIGHT AS memberHeight
             , A.WEIGHT AS memberWeight
             , A.STATUS AS memberStatus
             , A.REPORT_COUNT AS memberReportCount
             , A.DAILY_REPORT_COUNT AS memberDailyReportCount
             , A.GOOD_COUNT AS memberGoodCount
             , A.MONTHLY_GOOD_COUNT AS memberMonthlyGoodCount
             , A.CHEER_COUNT AS memberCheerCount
             , A.MESSAGE_ALLOW AS memberMessageAllow
        FROM MEMBER A
        WHERE A.ID = #{selectMemberId}
    </select>

    <select id="selectMemberByNum" parameterType="_int" resultType="fashionmanager.develop.dto.MemberDTO">
        SELECT
            A.NUM AS memberNum
             , A.ID AS memberId
             , A.PWD AS memberPwd
             , A.EMAIL AS memberEmail
             , A.NAME AS memberName
             , A.AGE AS memberAge
             , A.GENDER AS memberGender
             , A.HEIGHT AS memberHeight
             , A.WEIGHT AS memberWeight
             , A.STATUS AS memberStatus
             , A.REPORT_COUNT AS memberReportCount
             , A.DAILY_REPORT_COUNT AS memberDailyReportCount
             , A.GOOD_COUNT AS memberGoodCount
             , A.MONTHLY_GOOD_COUNT AS memberMonthlyGoodCount
             , A.CHEER_COUNT AS memberCheerCount
             , A.MESSAGE_ALLOW AS memberMessageAllow

             -- ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú Ïª¨Îüº --
             , A.PHONE    AS memberPhone
             , A.ADDRESS  AS memberAddress
        FROM MEMBER A
        WHERE A.NUM = #{selectMemberNum}
    </select>

    <update id="updateMemberByNum" parameterType="fashionmanager.develop.dto.MemberDTO">
        UPDATE MEMBER
        <set>
            <if test="memberId != null and memberId != ''">
                ID = #{memberId},
            </if>

            <!-- üîê ÎπÑÎ∞ÄÎ≤àÌò∏: ÏÑúÎπÑÏä§ÏóêÏÑú Ïù¥ÎØ∏ BCrypt Ïù∏ÏΩîÎî©Îêú Í∞íÏù¥ ÏûàÏùÑ ÎïåÎßå -->
            <if test="memberPwd != null and memberPwd != ''">
                PWD = #{memberPwd},
            </if>

            <if test="memberEmail != null and memberEmail != ''">
                EMAIL = #{memberEmail},
            </if>
            <if test="memberName != null and memberName != ''">
                NAME = #{memberName},
            </if>

            <!-- Ïà´ÏûêÎäî null Ï≤¥ÌÅ¨Îßå (0ÏùÑ Ïú†Ìö®Í∞íÏúºÎ°ú Ïì∏ Ïàò ÏûàÏúºÎãà) -->
            <if test="memberAge != null">
                AGE = #{memberAge},
            </if>
            <if test="memberHeight != null">
                HEIGHT = #{memberHeight},
            </if>
            <if test="memberWeight != null">
                WEIGHT = #{memberWeight},
            </if>

            <if test="memberGender != null and memberGender != ''">
                GENDER = #{memberGender},
            </if>

            <if test="memberPhone != null and memberPhone != ''">
                PHONE = #{memberPhone},
            </if>
            <if test="memberAddress != null and memberAddress != ''">
                ADDRESS = #{memberAddress},
            </if>
        </set>
        WHERE NUM = #{memberNum}
    </update>

    <select id="selectMember" resultType="fashionmanager.develop.dto.MemberDTO">
        SELECT
            A.NUM AS memberNum
             , A.ID AS memberId
             , A.PWD AS memberPwd
             , A.EMAIL AS memberEmail
             , A.NAME AS memberName
             , A.AGE AS memberAge
             , A.GENDER AS memberGender
             , A.HEIGHT AS memberHeight
             , A.WEIGHT AS memberWeight
             , A.STATUS AS memberStatus
             , A.REPORT_COUNT AS memberReportCount
             , A.DAILY_REPORT_COUNT AS memberDailyReportCount
             , A.GOOD_COUNT AS memberGoodCount
             , A.MONTHLY_GOOD_COUNT AS memberMonthlyGoodCount
             , A.CHEER_COUNT AS memberCheerCount
             , A.MESSAGE_ALLOW AS memberMessageAllow
             -- ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú Ïª¨Îüº --
             , A.PHONE    AS memberPhone
             , A.ADDRESS  AS memberAddress
        FROM MEMBER A
    </select>

    <select id="selectMemberRight" resultType="fashionmanager.develop.dto.MemberRightDTO">
        SELECT
            A.NUM AS memberNum
          , A.ID AS memberId
          , A.PWD AS memberPwd
          , A.EMAIL AS memberEmail
          , A.NAME AS memberName
          , A.AGE AS memberAge
          , A.GENDER AS memberGender
          , A.HEIGHT AS memberHeight
          , A.WEIGHT AS memberWeight
          , A.STATUS AS memberStatus
          , A.REPORT_COUNT AS memberReportCount
          , A.DAILY_REPORT_COUNT AS memberDailyReportCount
          , A.GOOD_COUNT AS memberGoodCount
          , A.MONTHLY_GOOD_COUNT AS memberMonthlyGoodCount
          , A.CHEER_COUNT AS memberCheerCount
          , A.MESSAGE_ALLOW AS memberMessageAllow
             -- ÏÉàÎ°ú Ï∂îÍ∞ÄÎêú Ïª¨Îüº --
          , A.PHONE    AS memberPhone
          , A.ADDRESS  AS memberAddress

          , B.MEMBER_STATE_NUM AS memberStateNum
          , C.NAME AS memberStateName
        FROM MEMBER A
        JOIN ASSIGNED_RIGHT B ON (A.NUM = B.MEMBER_NUM)
        JOIN MEMBER_STATUS C ON (C.NUM = B.MEMBER_STATE_NUM)
    </select>

    <select id="selectMemberRightBadge" resultType="fashionmanager.develop.dto.MemberRightBadgeDTO">
        SELECT
            A.NUM AS memberNum,
            A.ID AS memberId,
            A.PWD AS memberPwd,
            A.EMAIL AS memberEmail,
            A.NAME AS memberName,
            A.AGE AS memberAge,
            A.GENDER AS memberGender,
            A.HEIGHT AS memberHeight,
            A.WEIGHT AS memberWeight,
            A.STATUS AS memberStatus,
            A.REPORT_COUNT AS memberReportCount,
            A.DAILY_REPORT_COUNT AS memberDailyReportCount,
            A.GOOD_COUNT AS memberGoodCount,
            A.MONTHLY_GOOD_COUNT AS memberMonthlyGoodCount,
            A.CHEER_COUNT AS memberCheerCount,
            A.MESSAGE_ALLOW AS memberMessageAllow,
            B.MEMBER_STATE_NUM AS memberStateNum,
            C.NAME AS memberStateName,
            D.BADGE_NUM AS memberBadgeNum,
            E.NAME AS memberBadgeName
        FROM MEMBER A
                 JOIN ASSIGNED_RIGHT B ON (A.NUM = B.MEMBER_NUM)
                 JOIN MEMBER_STATUS C ON (C.NUM = B.MEMBER_STATE_NUM)
                 JOIN ASSIGNED_BADGE D ON (D.MEMBER_NUM = A.NUM)
                 JOIN BADGE E ON (E.NUM = D.BADGE_NUM);
    </select>


    <select id="selectMemberById" parameterType="string" resultType="fashionmanager.develop.dto.MemberDTO">
        SELECT
            A.NUM AS memberNum
             , A.ID AS memberId
             , A.PWD AS memberPwd
             , A.EMAIL AS memberEmail
             , A.NAME AS memberName
             , A.AGE AS memberAge
             , A.GENDER AS memberGender
             , A.HEIGHT AS memberHeight
             , A.WEIGHT AS memberWeight
             , A.STATUS AS memberStatus
             , A.REPORT_COUNT AS memberReportCount
             , A.DAILY_REPORT_COUNT AS memberDailyReportCount
             , A.GOOD_COUNT AS memberGoodCount
             , A.MONTHLY_GOOD_COUNT AS memberMonthlyGoodCount
             , A.CHEER_COUNT AS memberCheerCount
             , A.MESSAGE_ALLOW AS memberMessageAllow
        FROM MEMBER A
        WHERE A.ID = #{selectMemberId}
    </select>

    <select id="selectMemberRightById" parameterType="string" resultType="fashionmanager.develop.dto.MemberRightDTO">
        SELECT
            B.NUM AS memberNum
             , B.ID AS memberId
             , B.PWD AS memberPwd
             , B.EMAIL AS memberEmail
             , B.NAME AS memberName
             , B.AGE AS memberAge
             , B.GENDER AS memberGender
             , B.HEIGHT AS memberHeight
             , B.WEIGHT AS memberWeight
             , B.STATUS AS memberStatus
             , B.REPORT_COUNT AS memberReportCount
             , B.DAILY_REPORT_COUNT AS memberDailyReportCount
             , B.GOOD_COUNT AS memberGoodCount
             , B.MONTHLY_GOOD_COUNT AS memberMonthlyGoodCount
             , B.CHEER_COUNT AS memberCheerCount
             , B.MESSAGE_ALLOW AS memberMessageAllow
             , C.NUM AS memberStateNum
             , C.NAME AS memberStateName
        FROM ASSIGNED_RIGHT A
        JOIN MEMBER B ON (A.MEMBER_NUM = B.NUM)
        JOIN MEMBER_STATUS C ON (A.MEMBER_STATE_NUM = C.NUM)
        WHERE B.ID = #{selectMemberId}
    </select>

    <select id="selectMemberByEmail" parameterType="string" resultType="fashionmanager.develop.dto.MemberDTO">
        SELECT
            A.NUM AS memberNum
             , A.ID AS memberId
             , A.PWD AS memberPwd
             , A.EMAIL AS memberEmail
             , A.NAME AS memberName
             , A.AGE AS memberAge
             , A.GENDER AS memberGender
             , A.HEIGHT AS memberHeight
             , A.WEIGHT AS memberWeight
             , A.STATUS AS memberStatus
             , A.REPORT_COUNT AS memberReportCount
             , A.DAILY_REPORT_COUNT AS memberDailyReportCount
             , A.GOOD_COUNT AS memberGoodCount
             , A.MONTHLY_GOOD_COUNT AS memberMonthlyGoodCount
             , A.CHEER_COUNT AS memberCheerCount
             , A.MESSAGE_ALLOW AS memberMessageAllow
        FROM MEMBER A
        WHERE A.EMAIL = #{selectMemberEmail}
    </select>

    <select id="selectMemberByEmailAndId" parameterType="string" resultType="fashionmanager.develop.dto.MemberDTO">
        SELECT
            A.NUM AS memberNum
             , A.ID AS memberId
             , A.PWD AS memberPwd
             , A.EMAIL AS memberEmail
             , A.NAME AS memberName
             , A.AGE AS memberAge
             , A.GENDER AS memberGender
             , A.HEIGHT AS memberHeight
             , A.WEIGHT AS memberWeight
             , A.STATUS AS memberStatus
             , A.REPORT_COUNT AS memberReportCount
             , A.DAILY_REPORT_COUNT AS memberDailyReportCount
             , A.GOOD_COUNT AS memberGoodCount
             , A.MONTHLY_GOOD_COUNT AS memberMonthlyGoodCount
             , A.CHEER_COUNT AS memberCheerCount
             , A.MESSAGE_ALLOW AS memberMessageAllow
        FROM MEMBER A
        WHERE A.EMAIL = #{selectMemberEmail} and A.ID = #{selectMemberId}
    </select>
</mapper>

